{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KMGEG5CPC9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KMGEG5CPC9');
</script>

    <!-- Metas -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="@toxsltech">
    <!-- Title -->
    <title> spaceand Fido</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="{% static 'admin-assets/images/fav.ico' %}" />
    <!-- Bootstrap Css -->
    <link rel="stylesheet" href="{% static 'admin-assets/css/bootstrap.min.css' %}" />
    <!-- Plugins -->
    <link rel="stylesheet" href="{% static 'admin-assets/css/helpers-plugin.css' %}" />
    <!-- fontawesome Css -->
    <link rel="stylesheet" href="{% static 'admin-assets/fonts/fontawesome/css/all.min.css' %}" />

    <!-- Slick Slider -->
    <link rel="stylesheet" href="{% static 'admin-assets/css/slick-theme.css' %}" />
    <link rel="stylesheet" href="{% static 'admin-assets/css/slick.css' %}" />

    <!-- Style Css -->

    <link rel="stylesheet" href="{% static 'admin-assets/css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'admin-assets/rvt-css/common-style.css' %}" />
    <!-- jquery JS -->
    <script src="{% static 'admin-assets/js/jquery.js' %}"></script>
    <!-- bootstrap JS -->
    <script src="{% static 'admin-assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'admin-assets/js/moment.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'admin-assets/css/flash.css' %}" />
    <!-- Slick -->
    <script src="{% static 'admin-assets/js/slick.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'admin-assets/css/slick-theme.css' %}" />
    <link rel="stylesheet" href="{% static 'admin-assets/css/slick.css' %}" />
    <link rel="stylesheet" href="{% static 'admin-assets/css/custom-alert.css' %}" />
    <style>
        .alert_dot1 {
            width: 10px;
            height: 10px;
            background-color: #fb9a00;
            border: 2px solid #f1f1fb;
            position: absolute;
            display: inline-block;
            z-index: 1;
            border-radius: 50%;
            right: -3px;
            top: -2px;
            padding: 0.25em 0.4em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: 0.25rem;
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        }

        .bg-danger {
            background-color: #fb9a00 !important;
        }

        #card_err {
            color: red !important
        }

        .chnge_password {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
        }

        #loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border-top-color: #fff;
            color: #7f2bb5;
            position: fixed;
            left: 50%;
            top: 50%;
            z-index: 1;
            pointer-events: none !important;
        }

        #loading i {
            font-size: 50px;
        }

        #loading i {
            animation: spin 1s ease-in-out infinite;
            -webkit-animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to {
                -webkit-transform: rotate(360deg);
            }
        }
        @-webkit-keyframes spin {
            to {
                -webkit-transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="position-relative">
    <div class="body-overlay"></div>
    <!--Start of Tawk.to Script-->
<!--Start of Tawk.to Script-->
<!--Start of Tawk.to Script-->
<!--Start of Tawk.to Script-->
<script type="text/javascript">
    var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
    (function(){
    var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
    s1.async=true;
    s1.src='https://embed.tawk.to/62e989e854f06e12d88c9414/1g9m8gklr';
    s1.charset='UTF-8';
    s1.setAttribute('crossorigin','*');
    s0.parentNode.insertBefore(s1,s0);
    })();
    </script>
    <!--End of Tawk.to Script-->

    <main class="page-wrapper">
        <div id="sidebar" class="navbar-nav-left sidebar">
            <nav class="navbar navbar-expand-xl">
                <button id="nav-icon2" class="navbar-toggler mobile-menu d-xl-none" type="button" data-toggle="collapse"
                    data-target="#sidebar-nav" aria-controls="sidebar-nav" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <i class="fal fa-times-circle"></i>
                </button>
                <a class="navbar-brand" href="{% url 'frontend:index' %}">
                    <img src="{% static 'admin-assets/images/logo.png' %}">
                </a>

                {% if user.is_impersonate %}
                <div class="card ml-4 mr-4 mt-2 mb-2" style="background-color:#fccf00; animation: blinker 1s linear infinite">
                    <div class="card-body">
                      <p><strong>Name:</strong> {{request.user.first_name}} {{request.user.last_name}}</p>
                        <p><strong>Email:</strong> {{request.user.email}}</p>
                      <a class="btn pt-2 pb-2 btn-sm" href="/superuser/impersonate/stop/"> Stop Impersonation </a>
                      
                    </div>
                  </div>
                {% endif %}
                
                <div class="collapse navbar-collapse" id="sidebar-nav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link {% if  nbar == '' %} active {% endif %}"
                                href="{% url 'enduser:user_dashboard' %}"><img
                                    src="{% static 'admin-assets/images/icons/dash.svg' %}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'user_my_appointments' %} active {% endif %}"
                                href="{% url 'enduser:user_appointments' %}"><img
                                    src="{% static 'admin-assets/images/icons/appointment-user.svg' %}">Appointments</a>
                        </li>

                        <!--li class="nav-item">
                            <a class="nav-link {% if nbar == 'user_custom_requests' %} active {% endif %}"
                                href="{% url 'enduser:user_custom_requests' %}"><img
                                    src="{% static 'admin-assets/images/icons/appointment-user.svg' %}">Custom Requests</a>
                        </li-->

                        

                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'user_chat' %} active {% endif %}"
                                href="{% url 'enduser:users_chat_list' %}"><img
                                    src="{% static 'admin-assets/images/icons/inbox.svg' %}">Messages</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'settings' %} active {% endif %}"
                                href="{% url 'enduser:user_profile' %}"><img
                                    src="{% static 'admin-assets/images/icons/services.svg' %}">Settings</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'payments' %} active {% endif %}"
                                href="{% url 'enduser:user_payment'%}">
                                <img src="{% static 'admin-assets/images/icons/transaction.png' %}">Payments</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'find_rvt' %} active {% endif %}"
                                href="{% url 'enduser:find_nearby_rvts' %}">
                                <img src="{% static 'admin-assets/images/user/location.png' %}" class="">Find RVTs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if nbar == 'notifications' %} active {% endif %}"
                                href="{% url 'enduser:all_notifications_user' %}">
                                <img style="width: 18px;" src="{% static 'admin-assets/images/rvt/notifications.svg' %}"><span class="ml-2">Notifications</span></a>
                        </li>
                    </ul>
                    <div class="sidebar-extra-wrap">
                        {% comment %} <div class="button-wrap">
                            <a href="#" class="btn btn-theme btn-rounded w-100">
                                <img src="{% static 'admin-assets/images/rvt/order-supply.svg' %}" alt=""> Order Supply
                            </a>
                        </div> {% endcomment %}
                        <div class="app-download">
                            {% comment %} <h4>Download our apps now !</h4> {% endcomment %}
                            <h4> Apps launching soon!!</h4>
                            <div class="app-icon-wrap">
                                <a href="" class="app-icon">
                                    <img src="{% static 'admin-assets/images/icons/android.svg' %}" alt="">
                                </a>
                                <a href="" class="app-icon">
                                    <img src="{% static 'admin-assets/images/icons/ios.svg' %}" alt="">
                                </a>
                            </div>
                        </div>
                    </div> 
                </div>
            </nav>
        </div>
        {% if messages %}
        <div class="flash animate--drop-in-fade-out">
            {% for message in messages %}
            <div class="flash__icon">
                <i class="icon far fa-check-circle"></i>
            </div>
            <p class="flash__body">
                {{ message }}
            </p>
            {% endfor %}
        </div>
        {% endif %}
        <div id="content-wrapper" class="main-site-wrap media-body">
            <header class="header-main">
                <div class="d-flex align-items-center w-100">
                    <div class="header-left">
                        <div class="d-flex align-items-center">
                            <button id="nav-icon2" class="navbar-toggler mobile-menu d-xl-none" type="button"
                                data-toggle="collapse" data-target="#sidebar-nav" aria-controls="sidebar-nav"
                                aria-expanded="false" aria-label="Toggle navigation">
                                <div class="bar-one"></div>
                                <div class="bar-two"></div>
                                <div class="bar-three"></div>
                            </button>
                            {% if title == "Site administration" %}
                            <h2>Dashboard</h2>
                            {% else %}
                            <h2>{{title}}</h2>
                            {% endif %}
                        </div>
                    </div>
                    <div class="header-right media-body">
                        <div class="d-flex justify-content-end align-items-center">
                            <div class="header-small-menu d-none d-lg-inline-block">
                                <a href="{% url 'enduser:users_chat_list' %}">
                                    <img src="{% static 'admin-assets/images/rvt/messages.svg' %}">
                                    <span class="alert-dot"></span>
                                </a>
                                <a href="{% url 'enduser:help_user' %}">
                                    <img src="{% static 'admin-assets/images/rvt/help.svg' %}">
                                </a>
                                <span class="dropdown notification-dropdown">
                                    <button class="dropdown-toggle" type="button" id="dropdownMenuButton"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <img src="{% static 'admin-assets/images/rvt/notifications.svg' %}">
                                        <span
                                            class="alert-dot1 bg-danger notiCount-notification-container colour"></span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                                        <div class="nav-notification-header text-center">
                                            <h4 class="mb-0">Notification </h4>
                                        </div>
                                        <div class="nav-notification-body">
                                            <ul class="nav-list-items" id='t-d-bodys'>
                                            </ul>
                                        </div>
                                    </div>
                                </span>
                            </div>
                            <div class="profile-dropdown dropdown">
                                <button class="btn btn-secondary dropdown-toggle d-flex" type="button"
                                    id="dropdownProfileButton" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    {% if request.user.profile_pic %}
                                    <img src="{{request.user.profile_pic.url}}" alt="">
                                    {% else %}
                                    <img src="{% static 'admin-assets/images/default.png' %}" alt="">
                                    {% endif %}
                                    <div class="media-body">
                                        <p>{{request.user.first_name}}</p>
                                        <span>{{request.user.email}}</span>
                                    </div>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownProfileButton">
                                    <form onsubmit="Loader(this.id)" action="{% url 'enduser:user_status_change' %}" method="POST">
                                        <div class="checkbox-wrap switch-button d-flex align-items-center">
                                            <input type="hidden" value="{{request.user.id}}" name="user_id">
                                            {% csrf_token %}
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" id="active" name="state" 
                                                {% if request.user.status == True %}checked{% endif %}
                                                    onchange="this.form.submit()">
                                                <label class="form-check-label" for="active">Active</label>
                                            </div>
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" id="inactive" name="state"
                                                    {% if request.user.status == False %}checked{% endif %}
                                                    onchange="this.form.submit()">
                                                <label class="form-check-label" for="inactive">Inactive</label>
                                            </div>
                                        </div>
                                    </form>
                                    {% if request.user.is_verified == 1 or request.user.is_verified == '1' %}
                                    <a class="dropdown-item" id="getuser" href="{% url 'enduser:change_to_rvt' %}"><img
                                            src="{% static 'admin-assets/images/rvt/switch.png' %}" alt="">
                                        RVT Profile</a>
                                    {% endif %}
                                    <a class="dropdown-item" href="{% url 'enduser:user_profile' %}"><img
                                            src="{% static 'admin-assets/images/rvt/setting.png' %}" alt="">
                                        Settings</a>
                                    <a class="dropdown-item" href="{% url 'accounts:Password_Change' %}"><i
                                            class="fa fa-lock chnge_password"></i> Change Password</a>
                                    <a class="dropdown-item" href="{% url 'accounts:logout' %}"><img
                                            src="{% static 'admin-assets/images/rvt/logout.png' %}" alt=""> Log out</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="main-content-inner">
                <script>
                    $.get("{% url 'frontend:user_check_rvt' %}", { user_id: "{{request.user.id}}" }).done(function (data) {
                        let result = data["is_user"]
                        if (result == "true") {
                            $('#getuser').css('display', 'none');
                        }
                        else {
                            $('#getuser').css('display', 'block');
                        }
                    })
                </script>
                <script>
                    function ConvertGTime(createdate, createtime) {
                        var d = createdate + "T" + createtime + "Z";
                        const date = d;
                        const local = moment.utc(date).local().format("Do MMM  YYYY hh:mm A");
                        return local;
                    }
                </script>

                <script>
                    $(".colour").css('display', 'none')
                    $(".alert_dot1").css('display', 'none')
                    let user_interval = 60000;
                    var intervalId;
                    var mainintervalId;
                    $("#dropdownMenuButton").ready(function () {
                        var timesRun = 0;
                        mainintervalId = setInterval(function () {
                            timesRun += 1;
                            if (timesRun) {
                                $.ajax({
                                    url: "{% url 'enduser:notification_display_user' %}",
                                    type: 'GET',
                                    success: function (data) {
                                        let count = data.notifications
                                        if (count == 0) {
                                            $('.colour').css('display', 'none')
                                            $('.alert-dot1').css('display', 'none')
                                        } else {
                                            $('.alert-dot1').css('display', 'block')
                                            $('.colour').css('display', 'block')
                                            $('.alert-dot1').html(count)
                                        }
                                        $('#t-d-bodys').html('')
                                        let html3 = `<div class="media-body pl-0 pl-md-20 pt-10 pt-md-0 mb-10 mb-md-0" style="padding: 15px 0px;">
                                                        <h4 class="text-primary font-15 font_400 colspan="8" align="center"> No Notifications Found</h4>
                                                    </div>`
                                        let n_type = data['n_type']
                                        if (data.notifications < 1) {
                                            $('#t-d-bodys').append(html3)
                                        }
                                        else if (data.notifications >= 1 || n_type == 1 || n_type == 0) {
                                            //console.log(data)
                                            for (let i = 0; i < data.title.length; i++) {
                                                if (data['image'][i]) {
                                                    var image = data['image'][i]
                                                }
                                                else {
                                                    var image = "/static/admin-assets/images/default.png"
                                                }
                                                var title = data['title'][i]
                                                var created_for = data['created_for'][i]
                                                var descriptionn = data['description'][i]
                                                var time = data['created_on'][i]
                                                var app = data['appointment_id'][i]
                                                var cus = data['custom'][i]
                                                if (app) {
                                                    let html = `
                                                        <li class="notifications-list d-md-flex align-items-center" >
                                                        <div class="icon-wrap">
                                                            <img src="`+ image + `" class="rounded-circle object-cover border" alt="" />
                                                        </div>
                                                        <div class="media-body pl-0 pl-md-20 pt-10 pt-md-0 mb-10 mb-md-0" >
                                                            <a href="{% url 'enduser:appointment_details' %}?id=`+ app + `" ><h4 class="text-primary font-15 font_400"  >` + title + `</h4></a>
                                                            <p class="pl-0 ml-0">`+ descriptionn + `</p>
                                                        </div>
                                                        <div class="date text-right align-self-start" >`+ time + `</div>
                                                        </li>`
                                                    $('#t-d-bodys').append(html)
                                                } else if (cus) {
                                                    let html = `
                                                        <li class="notifications-list d-md-flex align-items-center" >
                                                        <div class="icon-wrap">
                                                            <img src="`+ image + `" class="rounded-circle object-cover border" alt="" />
                                                        </div>
                                                        <div class="media-body pl-0 pl-md-20 pt-10 pt-md-0 mb-10 mb-md-0" >
                                                            <a href="{% url 'enduser:applicants_details' %}?id=`+ cus + `" ><h4 class="text-primary font-15 font_400"  >` + title + `</h4></a>
                                                            <p class="pl-0 ml-0">`+ descriptionn + `</p>
                                                        </div>
                                                        <div class="date text-right align-self-start" >`+ time + `</div>
                                                        </li>`
                                                    $('#t-d-bodys').append(html)
                                                }
                                            }
                                            let html2 = `<div class="nav-notification-footer" >
                                                            <a href="{% url 'enduser:all_notifications_user'%}">See all notifications</a>
                                                        </div>`
                                            $('#t-d-bodys').append(html2)
                                        }
                                    }
                                })
                                intervalId = setInterval(user_interval);
                            } else {
                                clearInterval(intervalId);
                                clearInterval(mainintervalId);
                            }
                        }, 3000)

                    })
                </script>